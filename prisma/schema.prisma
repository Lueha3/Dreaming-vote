generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // pooler 6543
  directUrl = env("DIRECT_URL")     // direct 5432
}


model User {
  id         String   @id @default(cuid())
  churchCode String
  name       String
  phoneLast4 String
  createdAt  DateTime @default(now())

  @@unique([churchCode, name, phoneLast4])
  @@index([churchCode])
}

model Recruitment {
  id           String        @id @default(cuid())
  churchCode   String
  title        String
  content      String
  capacity     Int
  appliedCount Int           @default(0)
  status       String        @default("open")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  applications Application[]

  @@index([churchCode, status])
}

model Application {
  id                String      @id @default(cuid())
  recruitmentId     String
  contact           String
  contactNormalized String      @default("") @map("contact_normalized")
  name              String?
  message           String?
  createdAt         DateTime    @default(now())
  recruitment       Recruitment @relation(fields: [recruitmentId], references: [id], onDelete: Cascade)

  @@unique([recruitmentId, contactNormalized])
  @@index([recruitmentId, createdAt])
  @@index([contactNormalized])
  @@map("Application")
}
